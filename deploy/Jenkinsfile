pipeline {
    agent any

    environment {
        private_registry = "harbor.kcnet.bigdata.com:30443/bigdata"
        image_name = "bigdata_miniproject_api"
        reg_cred = "harbor_cred"
    }


    stages {
        stage('Init') {
            steps {
                script {
                    docker.withRegistry(private_registry, reg_cred)
                }
            }
        }

        stage('Bulid Docker') {
            steps{
                script {
                    docker_image = docker.build("${image_name}:latest", "--no-cache deploy/docker")
                }
                echo "docker build completed!!!"
            }
        }

        stage('Push Docker'){
            steps {
                script {
                    docker_image.push()
                }
                echo "docker image push completed"
            }
        }
    }
}